
# Slack ~/.ssh/config
#
# If SSH is broken, take it to #triage-ops.

HashKnownHosts no
ServerAliveCountMax 4320
ServerAliveInterval 10
TCPKeepAlive no
UseKeychain yes

Host ops*
    ForwardAgent yes

Host qa*
    HostName %h.slack.com
    ProxyCommand ssh -q aws-bastion.tinyspeck.com nc -q0 %h %p

Host bastion*.*.tinyspeck.com *-bastion.tinyspeck.com bastion*.slack-sec.com
    ControlMaster auto
    ControlPath /tmp/ssh-control-%r@%h:%p
    ControlPersist 43200
    HostName %h
    ProxyCommand none
    SendEnv DUO_PASSCODE

Host *.slack.com
    HostName %h

# tinyspeck.com short names
Host logs simmer
    HostName %h.tinyspeck.com

# slack-core short names
Host dev-sandbox
    HostName %h.slack-core.com

Host aux*
    HostName slack-db-%h.ec2.tinyspeck.com

Host cron* db* highlight* job-worker* redis* shard* www*
    HostName slack-%h.ec2.tinyspeck.com

# setting this here explicitly so it doesn't fall under the dev* rule below
# and try connecting to dev-analytics-master.tinyspeck.com.slack.com
Host dev-analytics-master.tinyspeck.com
    HostName dev-analytics-master.tinyspeck.com
    ProxyCommand ssh -q aws-bastion.tinyspeck.com nc -q0 %h %p

Host dev*
    HostName %h.slack.com

Host worker*
    HostName slack-job-%h.ec2.tinyspeck.com

Host analytics
    HostName dev-analytics-master.tinyspeck.com
    ProxyCommand ssh -q aws-bastion.tinyspeck.com nc -q0 %h %p

Host presto
    HostName prod-presto-master.tinyspeck.com
    ProxyCommand ssh -q aws-bastion.tinyspeck.com nc -q0 %h %p

Host airflow
    HostName airflow4.ec2.tinyspeck.com
    ProxyCommand ssh -q aws-bastion.tinyspeck.com nc -q0 %h %p

Host spark
    HostName dev-analytics-spark-master.tinyspeck.com
    ProxyCommand ssh -q aws-bastion.tinyspeck.com nc -q0 %h %p

Host staging
    ProxyCommand ssh -q aws-bastion.tinyspeck.com nc -q0 %h %p

# Play fast-and-loose with EC2-native hostnames.  This is admittedly slightly
# dangerous but we get IP addresses we've seen before so often that this is
# a pretty big productivity boost.
Host ec2-* ip-*
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null

Host *
    ProxyCommand $HOME/.ssh/magicproxy.sh %h %p
